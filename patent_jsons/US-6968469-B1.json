{"patent_number": "US-6968469-B1", "publication_id": 74444879, "family_id": 35345093, "publication_date": "2005-11-22", "titles": [{"lang": "EN", "text": "System and method for preserving internal processor context when the processor is powered down and restoring the internal processor context when processor is restored"}], "abstracts": [{"lang": "EN", "paragraph_markup": "<abstract lang=\"EN\" load-source=\"patent-office\" mxw-id=\"PA50897902\"><p num=\"p-0001\">A CPU (<b>1</b>) automatically preserves the CPU context in a computer memory (<b>5</b>) that remains powered-up when the CPU is powered down in sleep mode. By means of the preserved CPU context, the CPU is able to instantly and transparently resume program execution at the instruction of the program that was asserted for execution when the CPU was powered down. The CPU is permitted to power down frequently, even during execution of a program, and results in reduced average overall power consumption.</p></abstract>"}], "claims": [{"lang": "EN", "claims": [{"num": 1, "parent": -1, "type": "independent", "paragraph_markup": "<claim id=\"CLM-00001\" num=\"00001\"><claim-text>1. A method of reducing electrical power consumption by a digital computer when said digital computer is supplied with electrical power, but fails to process a computer application program for a prescribed period of inactivity, said digital computer including a host processor, said method comprising the computer implemented steps of:\n<claim-text>said host processor producing and maintaining an internal context, said host processor containing code morphing software for dynamically translating and executing target applications designed for execution by a target processor, whereby said host processor creates a virtual target processor, said host processor maintaining data representing the state of said virtual target processor during processing of instructions of a target application and said internal context of said virtual target processor, said digital computer also including a private memory for storing at least the state of said virtual target processor and target application and said internal context of said virtual target processor;</claim-text>\n<claim-text>determining if said prescribed period of inactivity has been attained, and, in response to an affirmative determination;</claim-text>\n<claim-text>preserving said internal context of said virtual target processor against loss due to removal of electrical power from said host processor, said internal context of said virtual target processor preserved in said private memory, wherein said private memory is accessible only by said host processor and powered independently of said host processor;</claim-text>\n<claim-text>producing a signature in response to said determining to indicate that said private memory contains information;</claim-text>\n<claim-text>removing all electrical power from said host processor, whereby said host processor is powered down, notwithstanding continued supply of electrical power to said digital computer; and</claim-text>\n<claim-text>restoring electrical power to said host processor and restoring said preserved internal context of said virtual target processor to said host processor when processing is to resume.</claim-text>\n</claim-text></claim>"}, {"num": 2, "parent": 1, "type": "dependent", "paragraph_markup": "<claim id=\"CLM-00002\" num=\"00002\"><claim-text>2. The method defined in <claim-ref idref=\"CLM-00001\">claim 1</claim-ref>, wherein said step of preserving said internal context of said virtual target processor against loss due to removal of electrical power from said host processor, includes:\n<claim-text>reading said internal context of said virtual target processor from the internal memory of said host processor prior to removal of electrical power from said host processor, said internal memory comprising internal registers; and</claim-text>\n<claim-text>writing said internal context of said virtual target processor into said private memory.</claim-text>\n</claim-text></claim>"}, {"num": 3, "parent": 1, "type": "dependent", "paragraph_markup": "<claim id=\"CLM-00003\" num=\"00003\"><claim-text>3. The method as defined in <claim-ref idref=\"CLM-00001\">claim 1</claim-ref> wherein said host processor includes a cache memory; and wherein said step of preserving said internal context of said virtual target processor, includes:\n<claim-text>supplying electrical power to said cache memory separately from said host processor, wherein removal of electrical power from said host processor leaves electrical power to said cache memory unaffected to prevent loss of said internal context of said host processor on removal of electrical power from said host processor.</claim-text>\n</claim-text></claim>"}, {"num": 4, "parent": 1, "type": "dependent", "paragraph_markup": "<claim id=\"CLM-00004\" num=\"00004\"><claim-text>4. The method as defined in <claim-ref idref=\"CLM-00001\">claim 1</claim-ref>, wherein the step of restoring electrical power to said host processor and restoring said preserved internal context of said virtual target processor to said host processor when processing is to resume, further comprises:\n<claim-text>initializing said host processor;</claim-text>\n<claim-text>determining whether application of electrical power was due to a power on reset condition or a resume from a suspend to RAM condition; and</claim-text>\n<claim-text>upon determining that electrical power commenced due to a resume from a suspend to RAM condition, then accessing and installing said preserved internal context of said virtual target processor to said host processor.</claim-text>\n</claim-text></claim>"}, {"num": 5, "parent": 1, "type": "dependent", "paragraph_markup": "<claim id=\"CLM-00005\" num=\"00005\"><claim-text>5. The method as defined in <claim-ref idref=\"CLM-00001\">claim 1</claim-ref>, wherein said step of restoring electrical power to said host processor and restoring said preserved internal context of said virtual target processor to said host processor when processing is to resume, further comprises:\n<claim-text>initializing said host processor;</claim-text>\n<claim-text>determining whether restoration of electrical power to said host processor is due to a power on reset condition or a resume from a suspend to RAM condition; and</claim-text>\n<claim-text>upon determining that electrical power commenced due to a resume from a suspend to RAM condition, then accessing said preserved internal context of said virtual target processor in said private memory and reading back said internal context of said virtual target processor into internal registers of said host processor for access by said host processor, whereby said internal context of said virtual target processor of said host processor is restored.</claim-text>\n</claim-text></claim>"}, {"num": 6, "parent": -1, "type": "independent", "paragraph_markup": "<claim id=\"CLM-00006\" num=\"00006\"><claim-text>6. A processing system, comprising:\n<claim-text>a central processing unit (CPU) for processing instructions of an application, said central processing unit including internal registers;</claim-text>\n<claim-text>a first memory;</claim-text>\n<claim-text>a second memory accessible only to said CPU;</claim-text>\n<claim-text>a power supply for supplying power separately to said CPU and said first and second memories, wherein said CPU, said first memory and said second memory each reside in separate power domains;</claim-text>\n<claim-text>said power supply including:</claim-text>\n<claim-text>a rechargeable battery;</claim-text>\n<claim-text>first power circuit means for distributing electrical power to said CPU;</claim-text>\n<claim-text>second power circuit means for distributing electrical power to at least said first memory and said second memory; and</claim-text>\n<claim-text>an on-off switch for closing power from said battery to each of said first and second power circuit means, whereby said first and second power circuit means are enabled to deliver power;</claim-text>\n<claim-text>first program routine means for detecting inactivity of application instruction processing of said CPU for a period of time, Tmax;</claim-text>\n<claim-text>second program routine means for saving the internal context of said CPU in said second memory and for producing a signature in response to a positive detection of inactivity by said first program routine means, said signature indicating that said second memory contains information;</claim-text>\n<claim-text>third program routine means for terminating distribution of power by said first power circuit means following completion of said second program routine means, whereby power is removed from said CPU while said internal context of said CPU is preserved in said second memory.</claim-text>\n</claim-text></claim>"}, {"num": 7, "parent": 6, "type": "dependent", "paragraph_markup": "<claim id=\"CLM-00007\" num=\"00007\"><claim-text>7. The processor as defined in <claim-ref idref=\"CLM-00006\">claim 6</claim-ref>, further comprising:\n<claim-text>a user operated input device for enabling user input to said application;</claim-text>\n<claim-text>means for enabling said second power circuit means to distribute power to said CPU, responsive to operation of said user operated input device;</claim-text>\n<claim-text>program means responsive to re-energization of said CPU for initiating an initialization process for said CPU;</claim-text>\n<claim-text>loading and processing a boot loader;</claim-text>\n<claim-text>configuring internal memory of said CPU, excluding said second memory;</claim-text>\n<claim-text>resetting registers of said CPU; and</claim-text>\n<claim-text>checking for said signature;</claim-text>\n<claim-text>fourth routine program means, responsive to detection of said signature, for retrieving the portion of said internal context of said CPU earlier stored in said internal memory of said CPU and reading back said portion of said internal context of said CPU into the internal registers of said CPU, and retrieving said context of said Northbridge registers and loading said context of said Northbridge registers in said internal memory of said CPU.</claim-text>\n</claim-text></claim>"}, {"num": 8, "parent": 7, "type": "dependent", "paragraph_markup": "<claim id=\"CLM-00008\" num=\"00008\"><claim-text>8. The processor as define in <claim-ref idref=\"CLM-00007\">claim 7</claim-ref>, further comprising:\n<claim-text>fifth routine program means for retrieving the next instruction of the application program for execution by said CPU, responsive to completion of said fourth routine program means.</claim-text>\n</claim-text></claim>"}, {"num": 9, "parent": -1, "type": "independent", "paragraph_markup": "<claim id=\"CLM-00009\" num=\"00009\"><claim-text>9. A processing system, comprising:\n<claim-text>a central processing unit for processing instructions, said central processing unit including internal registers;</claim-text>\n<claim-text>a first memory;</claim-text>\n<claim-text>a second memory accessible only to said central processing unit;</claim-text>\n<claim-text>code morphing program means defining a virtual X86 processing system, said virtual X86 processing system including a virtual X86 central processing unit and a virtual Northbridge chip, whereby instructions of an X86 application may be processed in said processing system;</claim-text>\n<claim-text>a power supply for supplying power separately to said CPU and said first and second memories, wherein said CPU, said first memory and said second memory each reside in separate power domains;</claim-text>\n<claim-text>said power supply including:</claim-text>\n<claim-text>a rechargeable battery;</claim-text>\n<claim-text>first power circuit means for distributing electrical power to said CPU;</claim-text>\n<claim-text>second power circuit means for distributing electrical power to at least said first and second memory; and</claim-text>\n<claim-text>an on-off switch for closing power from said battery to each of said first and second power circuit means, whereby said first and second power circuit means are enabled to deliver power;</claim-text>\n<claim-text>first program routine means for detecting inactivity of application instruction processing of said CPU for a period of Tmax;</claim-text>\n<claim-text>second program routine means for saving the entire internal context of said CPU in said second memory and for producing a signature in response to a positive detection of inactivity by said first program routine means, said signature indicating that said second memory contains information;</claim-text>\n<claim-text>third program routine means for terminating distribution of power by said first power circuit means following completion of said second program routine means, whereby power is removed from said CPU and said CPU is placed in an off state while said internal context of said CPU is preserved in said second memory.</claim-text>\n</claim-text></claim>"}, {"num": 10, "parent": 9, "type": "dependent", "paragraph_markup": "<claim id=\"CLM-00010\" num=\"00010\"><claim-text>10. The processor as defined in <claim-ref idref=\"CLM-00009\">claim 9</claim-ref>, further comprising:\n<claim-text>means for enabling said second power circuit mean distribute power to said CPU, responsive to operation of said user operated input device;</claim-text>\n<claim-text>program means responsive to re-energization of said CPU for initiating an initialization process for said CPU;</claim-text>\n<claim-text>loading and processing a boot loader;</claim-text>\n<claim-text>configuring internal memory of said CPU, excluding said second memory;</claim-text>\n<claim-text>resetting the registers of said CPU; and</claim-text>\n<claim-text>checking for said signature;</claim-text>\n<claim-text>fourth program routine means, responsive to detection of said signature, for retrieving the portion of said internal context of said CPU earlier stored in one of said first and second memory and reading back said portion into the internal registers of said CPU, and retrieving said context of said Northbridge registers earlier stored in one of said first and second memory and loading said context in said internal registers of said CPU.</claim-text>\n</claim-text></claim>"}, {"num": 11, "parent": -1, "type": "independent", "paragraph_markup": "<claim id=\"CLM-00011\" num=\"00011\"><claim-text>11. A digital computer comprising: a CPU; a private memory accessible only by said CPU; and a power supply, said power supply for supplying power to said CPU and said private memory independent of one another to enable withdrawal of power from said CPU without withdrawal of power from said private memory; said CPU defining and maintaining a CPU context to enable processing of application programs; said CPU containing code morphing software for dynamically translating and executing target applications designed for execution by a target processor, whereby said CPU creates a virtual target processor, said CPU maintaining data representing the state of said virtual target processor during processing of instructions of a target application and said internal context of said virtual target processor; said private memory for storing at least the state of said virtual target processor and said target application, said internal context of said virtual target processor and said CPU context, whereby said CPU context is retained upon withdrawal of power from said CPU without withdrawal of power from said private memory and wherein a flag is set to indicate that said private memory contains said CPU context.</claim-text></claim>"}, {"num": 12, "parent": -1, "type": "independent", "paragraph_markup": "<claim id=\"CLM-00012\" num=\"00012\"><claim-text>12. A method of reducing power consumption of a digital computer during a sleep mode of operation, said digital computer including a power management program for placing said digital computer in multiple stages of sleep mode, said multiple stages of sleep comprising at least a pre-STR (suspend to RAM) stage and an STR stage, said method comprising:\n<claim-text>determining whether a first instruction is issued said power management program for placing said digital computer in a pre-STR stage of sleep, said pre-STR stage comprising maintaining power to a processor of said digital computer;</claim-text>\n<claim-text>intercepting said first instruction; and</claim-text>\n<claim-text>substituting for said first instruction a second instruction to place said digital computer in said STR stage of sleep, said STR stage comprising removing power from said processor, wherein entry to said STR stage occurs bypassing said pre-STR stage in response to said first instruction and transparent to said power management program.</claim-text>\n</claim-text></claim>"}, {"num": 13, "parent": 12, "type": "dependent", "paragraph_markup": "<claim id=\"CLM-00013\" num=\"00013\"><claim-text>13. The method of <claim-ref idref=\"CLM-00012\">claim 12</claim-ref> further comprising:\n<claim-text>writing internal context of said processor to a private memory accessible only by said processor and powered independently of said processor; and</claim-text>\n<claim-text>removing power from said processor.</claim-text>\n</claim-text></claim>"}, {"num": 14, "parent": -1, "type": "independent", "paragraph_markup": "<claim id=\"CLM-00014\" num=\"00014\"><claim-text>14. A computer system comprising:\n<claim-text>a processor;</claim-text>\n<claim-text>a first memory accessible by said processor;</claim-text>\n<claim-text>a second memory accessible only to said processor, wherein said second memory is internal to said processor, wherein power to said second memory is controlled separately from power to said processor and to said first memory, wherein power is maintained to said second memory when power is removed from said processor, said second memory for maintaining internal context of said processor when power is removed from said processor; and</claim-text>\n<claim-text>a third memory external to said processor and accessible only to said processor, wherein power to said third memory is controlled separately from power to said processor and to said first and second memories.</claim-text>\n</claim-text></claim>"}]}], "descriptions": [{"lang": "EN", "paragraph_markup": "<description lang=\"EN\" load-source=\"patent-office\" mxw-id=\"PDES15948009\"><?BRFSUM description=\"Brief Summary\" end=\"lead\"?><h4>FIELD OF THE INVENTION</h4><p num=\"p-0002\">This invention relates to sleep modes for digital computers and, more particularly, to a novel method and apparatus for reducing battery power drain in portable computers during periods in which the computer is left idle for a time, even momentarily, while restoring CPU operation instantaneously once processing is to resume.</p><h4>BACKGROUND</h4><p num=\"p-0003\">Portable digital computers rely on rechargeable DC batteries to provide the electrical power necessary for operation. When the computer is powered on for processing operation, but allowed to remain idle, the battery continues nonetheless to supply current to all the components of the computer, including the central processing unit (CPU), memory, the chipset (e.g. the Southbridge) and the display of the computer. If the user fails to turn off the computer, the battery continues to supply full current and, eventually, becomes drained of the stored electrical power. The foregoing action leads to more frequent recharging of the battery, and reduces the utility and usability of the computer system.</p><p num=\"p-0004\">To reduce battery drain under such circumstances, a power management technique was previously introduced for portable computers, called the \u201csleep\u201d mode. Typically, portable computers based on the INTEL X86 CPU and associated chip set, referred to as \u201cPC's\u201d, include multiple sleep modes (e.g. states of sleep mode). The multiple sleep modes enable the portable computer, when left idle, to selectively power down the components and devices of the computer in stages, although the main power remains on. With the computer spending an increasing amount of time idling, the computer progresses through increasingly deeper and deeper stages of sleep mode (and hence, greater reductions in power consumption). One of the deepest of those modes is characterized by all of the devices, including the CPU, but excepting the main memory (RAM) and the Southbridge chip, being powered down. This latter mode is typically referred to as \u201cSuspend to RAM\u201d (\u201cSTR\u201d) or as \u201cPower-on-Suspend\u201d (\u201cPOS\u201d) or like terms. In the STR condition power consumption is dramatically reduced and offers the greatest power reduction short of that power reduction obtained by turning off every component of the computer, the latter being referred to as \u201csuspend to disk\u201d, essentially completely shutting down the computer.</p><p num=\"p-0005\">The sleep modes in the PC are defined and controlled by the operating system software, such as familiar Windows 9X, Unix, Linux and the like, in conjunction with the system BIOS of the computer. When in STR, the Southbridge portion of the chip set, which is responsible for power management of the PC, continues to monitor the keyboard and mouse (and/or resume key) of the PC for any user activity, signifying an end to the computer idle condition.</p><p num=\"p-0006\">When the user later returns to perform computing and observes the computer is in a sleep mode, the user operates a \u201cresume\u201d key (or any key of the keyboard) or the like. That action initiates a chain of events in the computer, transparent to the user, that restores full power to the CPU; and the computer recovers quickly. Return from the upper stages of the sleep mode recovers more quickly than recovery from the STR stage, the deepest stage after the Suspend to Disk stage, the latter recovery procedure being referred to as a \u201cresume from STR\u201d.</p><p num=\"p-0007\">Of particular convenience, the user may immediately resume computing at the precise location in any application program that was active in the computer at the time the computer entered the sleep mode. To reach that point from the STR stage of sleep mode, the CPU processes a number of steps of the \u201cboot-up\u201d routine for the computer; steps that typically occur in a manner transparent to the user. The computer is able to resume where it left off, because, prior to entering STR, the computer preserved the complete state of all software applications and of all components and devices, including the CPU, in a memory that remained powered up during the \u201csleep\u201d.</p><p num=\"p-0008\">For the power management technique of sleep mode, the CPU and the external memory (DRAM) are independently supplied with power, that is, are located in separate power domains. In the deepest sleep mode, STR, power is removed from the CPU (and other electronic components of the computer, such as the display), while maintaining the DRAM memory and the Southbridge chip under power. The application programs and the state of those application programs (e.g. the CPU \u201ccontext\u201d) is preserved by transferring the state information to the DRAM.</p><p num=\"p-0009\">In processing operation, the CPU executes application programs by continuously modifying both its internal state and memory contents according to the instructions of the program. The internal CPU memory of the X86 system resides in the same power domain as the CPU. Thus, whenever the CPU is powered down, such as for an STR procedure, the internal memory is also powered down, and normally results in the loss of that CPU context. In order for the CPU of the X86 system to resume processing of an application program on Resume from STR, the processor must at that time at least \u201cknow\u201dthe state of the program on entering STR. Before entering STR, the CPU executes an instruction (of the power management software) that saves the CPU context at a well defined location in external memory, such as the DRAM memory. That context information subsumes the state of the operating system and the state of the application program. By maintaining power to the DRAM during STR, the state information of the program is preserved, and is available for use later upon a Resume from STR.</p><p num=\"p-0010\">Once the resume button is pressed and is detected by the Southbridge chip, power is reapplied to the CPU, which commences its start-up routines. The CPU processes the normal boot-up routine stored in the ROM of the BIOS chip. That boot up procedure initializes the internal registers of the CPU and flushes its caches, thereby establishing a baseline state for the CPU. The process takes a noticeable time in which to complete. However, prior to loading the operating system, such as Windows 9X, the routine checks to determine if the boot-up procedure is a \u201cpower up reset\u201d as occurs upon initially powering up the computer, or instead is a Resume from STR. When the routine detects the latter condition, the computer \u201cknows\u201d that the state of the operating system software, any application program, and the corresponding CPU context already resides in the external memory (DRAM). The CPU then completes the boot-up procedure by restoring the device states, and, with a special instruction, finally restores the CPU context from the external memory. Thereafter, the CPU is able to simply proceed with executing the next application program instruction exactly where the CPU left off when entering STR.</p><p num=\"p-0011\">In a stage of sleep mode that lies one stage above the STR stage, the penultimate stage (e.g. the pre-STR stage) referred to as \u201cdeep sleep\u201d, existing operating systems issue an instruction to remove the system clock from the CPU, but to maintain the CPU powered up, continuing to consume battery power. The removal of the system clock reduces power consumption also, but that is not as great a reduction as when power is removed from the CPU, such as during STR. Without clock signals being applied, the CPU is no longer able to process (as would consume additional current), but maintains system context in the associated internal registers of the CPU. That context is not lost and is not required to be saved to external memory as is the case in entering the STR stage. As an advantage, the invention powers down the CPU in all sleep modes and preserves the CPU context, saving additional power.</p><p num=\"p-0012\">Accordingly, an object of the invention is to reduce the power consumption of a computer during periods in which the computer is idle, providing a more effective sleep mode.</p><p num=\"p-0013\">Another object of the invention is to promote the pre-STR stage of sleep mode in existing power management systems to the STR stage, creating an \u201cInstant STR\u201d, and reduce the time required by the computer system to return from that stage, ideally providing a Resume from STR that appears instantaneous.</p><p num=\"p-0014\">And, a related object of the invention is to replace on-the-fly a CPU context maintaining sleep mode of existing computer systems that is governed by the operating system with a substitute sleep mode that affords a lower power consumption and remains transparent to the software.</p><h4>SUMMARY OF THE INVENTION</h4><p num=\"p-0015\">In accordance with the foregoing objects and advantages, the present invention provides for saving the internal context of the CPU (which includes the state of the application software) and powering down the CPU not only for an STR condition but for any pre-STR stage of sleep mode, and for restoring the state, including such internal context, on the Resume from STR condition, whereby the processor system is quickly restored for operation ready to execute the next instruction of the application program. With the invention, any stage of sleep mode can be promoted to an STR condition to completely power down the CPU in a manner that is transparent to the operating system.</p><p num=\"p-0016\">When applied to directly to existing X86 applications and operating systems, the present invention intercepts (or converts) an instruction that calls for an X86 type computer system to enter a CPU context-maintaining sleep mode, a pre-STR stage of sleep mode, and \u201cpromotes\u201d or converts that instruction into an instruction to enter the STR stage, and thereafter perform all of the actions described for entering STR. Whereas the X86 operating system of the CPU may \u201cthink\u201d that the context of the application program has been saved in one way, the present system actually saves that program context and the CPU context in a different manner, transparent to the X86 operating system. When Resuming from STR, the context is restored, and the X86 operating system is none the wiser.</p><p num=\"p-0017\">In accordance with a more specific aspect, the present invention provides a private memory within the processor system, a memory external to the CPU, that is accessible only to the CPU and is powered independently of the CPU to store the CPU context when the CPU is powered down in a sleep mode. The private memory may constitute a logical portion of the external memory, DRAM, in the X86 system, or may be physically separate therefrom or may constitute a logical partition of the CPU internal memory, such as a cache or subset of such cache. Like the existing DRAM, a key characteristic of the foregoing memory is that such memory is independently powered from the CPU core. In the Transmeta processing system, hereafter noted, that memory may be commandeered to serve as private memory for code morphing software (e.g. \u201cCMS memory\u201d). The power down routine for sleep mode includes reading the internal CPU context from the internal memory of the CPU, caches and registers, and writing that context within the private memory. When powered up, either initially or on return from STR, the processor determines whether to perform a normal power up operation, called a power on reset, or a context-restoring operation.</p><p num=\"p-0018\">On entering into the Instant STR condition, before concomitant powering down of the CPU of the computer, the CPU preserves the entire CPU context in the independently powered private external memory of the CPU. So long as the private memory remains powered up, the CPU context is preserved despite the fact that the CPU is powered down. Upon Resume from Instant STR to resume processing, power is restored to the CPU. During the boot-up process, the CPU detects that the condition is a resume from Instant STR and, in response, restores its entire internal state from the preserved CPU context located in the private memory. Thereafter the CPU may perform an internal resume to the instruction of the application program that follows the last completed instruction of that program.</p><p num=\"p-0019\">As an advantage, the CPU is able to automatically and transparently recover from a sleep mode that powers down the CPU and continue execution of any arbitrary computer program after lapses of arbitrary duration in the sleep mode without any assistance being required of the operating system, BIOS or the like.</p><p num=\"p-0020\">The present invention is particularly adaptable to incorporation within and enhances a newly disclosed processor system that is found to already contain a private memory that is powered separately from the processor, but is used to store, among other things, only a part of the internal context of the CPU. That processor system is the very long instruction word (VLIW) processor described, for one, in U.S. Pat. No. 6,031,992, granted Feb. 29, 2000, entitled Combining Hardware and Software to provide an Improved Microprocessor, assigned to Transmeta Corporation, (referred to as the 992 Transmeta patent), which is incorporated herein by reference.</p><p num=\"p-0021\">The processor of the 992 Transmeta patent is formed by a combination of a hardware processing portion (called a \u201cmorph host\u201d), and an emulating software portion, referred to therein as code morphing software. Among other things, the code morphing software carries out a significant portion of the functions of processors in software, reducing the hardware required for processing and the greater electrical power that such hardware requires. The Transmeta processor serves as the host processor system capable of executing software programs (the \u201ctarget application\u201d) designed with an instruction set intended to run on a processor system of different design, the target processor, one that contains an instruction set unique to the target processor, but foreign to the host system, such as the X86 type processor.</p><p num=\"p-0022\">That processor translates instructions that comprise a target software program \u201con-the-fly\u201d into instructions of the host instruction set (the host instructions); and then executes the latter instructions. In so doing, the morph host processor executes the code morphing software which, functioning as either a software \u201cinterpreter\u201d or \u201ctranslator\u201d of target application programs into host processor instructions, which are able to accomplish the purpose of the original application software. For translation, the code morphing software defines a translator, which converts the target instructions to host instructions, and a translation process that translates the target application programs dynamically and optimizes the latter host instructions to provide an optimized translation.</p><p num=\"p-0023\">The foregoing Transmeta processing system, hereafter referred to as the Transmeta processor, necessarily keeps track of its state or CPU context during processing operation. It is found that the Transmeta processor places a considerable portion of its CPU context on memory external of the CPU, such as DRAM. Conceptually, that external memory is herein referred to as \u201cprivate\u201d CPU memory, because that memory is not visible to (and cannot be accessed by) external application programs; and only the code morphing software of the CPU is able to access the private memory. Further the CPU private memory resides in a different power domain than the CPU, and, therefore, may be powered up or down independently of the CPU. Consequently, the private memory is able to maintain a portion of the internal state of the CPU when the CPU is powered down.</p><p num=\"p-0024\">Other portions of the CPU context are saved in memory (caches) internal to the CPU, apart from the private memory. Normally that portion of the CPU context (information) would disappear whenever the Transmeta processor is powered down. In accordance with the present invention, the entire CPU context of the Transmeta processor is stored in the private memory in the Instant STR process. Accordingly, a further object of the invention is to provide a portable computer constructed in accordance with the Transmeta processing system with an improved power saving sleep mode.</p><p num=\"p-0025\">When powered up, either initially or on return from Instant STR, the processor determines whether it is to perform a normal power up operation (a power on reset) or a context-restoring operation. Traditional processors typically employ external circuitry to make that decision. The Transmeta processor deposits the corresponding persistent information in the private memory. The presence of that information in the private memory is called an \u201cSTR signature\u201d.</p><p num=\"p-0026\">As an advantage, the Transmeta CPU is able to automatically and transparently recover from a sleep mode in which the CPU is powered down and continue execution of any arbitrary application program, including target applications, after time lapses of arbitrary duration in the sleep mode without any assistance required of the application program. Upon resume from such a sleep mode, the Transmeta processor is able to continue with execution of a target application program. The Transmeta processor is capable of suspending arbitrary X86 computer programs to private memory (e.g. CMS memory) and automatically and transparently resume executing the next instruction of the program without any assistance of the target application.</p><p num=\"p-0027\">The foregoing and additional objects and advantages of the invention together with the structure characteristic thereof, which was only briefly summarized in the foregoing passages, will become more apparent to those skilled in the art upon reading the detailed description of a preferred embodiment of the invention, which follows in this specification, taken together with the illustrations thereof presented in the accompanying drawings.</p><?BRFSUM description=\"Brief Summary\" end=\"tail\"?><?brief-description-of-drawings description=\"Brief Description of Drawings\" end=\"lead\"?><description-of-drawings><h4>BRIEF DESCRIPTION OF THE DRAWINGS</h4><p num=\"p-0028\">In the drawings:</p><p num=\"p-0029\"><figref idrefs=\"DRAWINGS\">FIG. 1</figref> is a high-level block diagram of one embodiment of a digital processor which incorporates the invention.</p><p num=\"p-0030\"><figref idrefs=\"DRAWINGS\">FIG. 2</figref> is a flow chart defining the operation of the processor of <figref idrefs=\"DRAWINGS\">FIG. 1</figref>.</p><p num=\"p-0031\"><figref idrefs=\"DRAWINGS\">FIG. 3</figref> is a high-level block diagram of another embodiment of a digital processor which incorporates the invention.</p></description-of-drawings><?brief-description-of-drawings description=\"Brief Description of Drawings\" end=\"tail\"?><?DETDESC description=\"Detailed Description\" end=\"lead\"?><h4>DETAILED DESCRIPTION OF THE PREFERRED EMBODIMENTS</h4><p num=\"p-0032\">The invention is preferably implemented within the improved 992 Transmeta processor system earlier described, which implements software-enhanced execution (eg. dynamic translation), and is best explained in connection with that processor. The principal elements of that processing system as modified to incorporate the invention are symbolically illustrated in <figref idrefs=\"DRAWINGS\">FIG. 1</figref>, to which reference is made. The processing system contains a computer processing unit (\u201cCPU\u201d) <b>1</b>, a memory <b>3</b> for the X86 program, the target machine code that the processor is to translate, its data, and a memory <b>5</b> with the private runtime support for the computer, the latter memory herein referred to as private memory. Memory <b>3</b> may encompass the entire memory hierarchy, including disk, RAM, 2<sup>nd </sup>level cache and 1<sup>st </sup>level cache. ROM memory, which is used by the processor, is considered as being separate from the processor, and for purposes of this description is not considered as part of the memory hierarchy of the processor. The foregoing illustration also excludes the memory that is regarded as internal to the CPU (\u201cinternal\u201d memory).</p><p num=\"p-0033\">The foregoing architecture is recognized as different from the traditional processor systems, such as the X86 system, which does not contain memory <b>5</b>. As represented by the power arrows P<b>1</b>, the private memory <b>5</b> resides in a separate power domain than CPU <b>1</b> (and memory <b>3</b>). Hence, electrical power to each component of the system may be separately and independently controlled, more specifically, CPU <b>1</b> may be powered down, while private memory <b>5</b> remains powered.</p><p num=\"p-0034\">During processing operation, the Transmeta CPU <b>1</b> keeps track of its state or context. Since the Transmeta computer \u201cvirtualizes\u201d the target processor, such as the X86 processor system, the computer must also keep track of the state of the X86 processor system, possibly including part of the chipset and the target (X86) application program for that processor, which is being translated and executed by the code morphing software. Hence, the context of the Transmeta processor constitutes a super-set of and subsumes the state of the X86 processor system.</p><p num=\"p-0035\">The context of the Transmeta processing system is reflected in the contents of the general purpose registers, including core special registers (\u201cCSR's\u201d), peripheral special registers (\u201cPSR's\u201d), and the Northbridge registers, the D-cache, the I-cache, local program memory (\u201cLPM\u201d), and local data memory (\u201cLDM\u201d). Some of that context is stored in private memory <b>5</b>. However, the internal context of CPU <b>1</b> is stored in internal memory, represented in the dotted block <b>6</b> within CPU <b>1</b>.</p><p num=\"p-0036\">The Transmeta computer includes a start up procedure to initialize and configure (\u201cset up\u201d) the computer and begin processing, a procedure defined by software or in firmware, such as ROM code, which is included. That start-up procedure (\u201cboot-up\u201d) is initiated once power to the computer is switched on to apply power (P<b>1</b>, P<b>2</b>, and P<b>3</b>) to both the CPU <b>1</b> and memories <b>3</b> and <b>5</b>, a \u201cboot-up\u201d procedure referred to as \u201cpower-on reset\u201d.</p><p num=\"p-0037\">The processor commences the start up procedure, as represented by operation <b>11</b> in <figref idrefs=\"DRAWINGS\">FIG. 2</figref> to which reference is made. Both the code morphing software and the CMS boot loader software of the Transmeta processing system are stored in compressed form in flash ROM (not illustrated) of the computer.</p><p num=\"p-0038\">The CPU locates the CMS boot loader routine in the flash ROM and installs that routine in internal memory <b>6</b>, as represented at block <b>13</b>. As represented by operation <b>15</b>, the CMS boot loader continues with configuring the cache, the private memory <b>5</b>, and, possibly, the other memory.</p><p num=\"p-0039\">At this juncture, and in accordance with the invention, the boot loader looks for an \u201cSTR signature\u201d, operation <b>19</b>, which is later described herein in greater detail in connection with a Resume from STR condition. However, since the initial power on reset of the computer is presently being described, the STR signature is not present, and the decision at decisional block <b>21</b> is negative. A discussion of the operation that occurs when the STR signature is found is reserved to a later point in this description. The normal power on reset process continues, represented at operation <b>23</b>, with the boot loader program requiring CPU <b>1</b> to locate the compressed CMS in the flash ROM, decompress the CMS and load that software in the private memory <b>5</b> where stored for use in processing. Depending upon the design of the computer, the program may also set up a debugging environment for the processor, prior to decompressing the code morphing software.</p><p num=\"p-0040\">Once stored in private memory <b>5</b>, the boot loader routine \u201cjumps\u201d into the code morphing software at its \u201creset\u201d vector in private memory <b>5</b>, as represented at block <b>25</b> and begins executing (e.g. starts) the CMS. On starting, the CMS resets the CPU registers and establishes the CPU context, as represented by block <b>27</b>A, configures other memory, block <b>27</b>B, and then commences normal processing, the details of which are not relevant or material to the present invention.</p><p num=\"p-0041\">Continuing with right side of <figref idrefs=\"DRAWINGS\">FIG. 2</figref>, during normal processor operation, which in accordance with the present invention includes the sleep mode, the power management sub-routine of the BIOS or operating system periodically checks for activity on the processor keyboard and other user input devices, and, as represented by block <b>10</b>, checks to determine if instructions of an application program are being executed by the processor. The routine also records and stores the time of the last such activity and compares that time to the time of the present check to determine if the interval is greater than a predetermined time, Tmax, represented by decisional block <b>12</b>. If not, the determination is negative and normal processing activity of the processor continues, as represented at block <b>14</b>, including periodically repeating the activity check operation indicated by the dotted line to block <b>10</b>.</p><p num=\"p-0042\">Should the period of inactivity continue until the comparison determination results in an interval of greater than Tmax, a flag is set, represented by an affirmative decision at block <b>12</b>. On finding that flag, the CPU program branches from the main routine to retrieve and execute the Instant STR routine, as represented at block <b>16</b>.</p><p num=\"p-0043\">An initial step in the Instant STR routine is to retrieve the part of the CPU context and Northbridge registers that is stored in the CPU's internal memory, and save that context in private memory <b>5</b>. As represented at block <b>18</b>, the foregoing state information is stored in the private memory along with the normal X86 execution state information, which the Transmeta processor normally saves in that memory.</p><p num=\"p-0044\">Thereafter, the processor initiates the chipset to shut down power to CPU <b>1</b> (and other components of the processor), excepting the private memory <b>5</b>, after a defined short time interval and sets the STR signature, as represented by operation <b>20</b>. The chipset withdraws the power P<b>1</b> to the CPU, which ceases operation at this point. Any information in the internal memories of the CPU disappears. Since private memory <b>5</b> remains powered up, that is, P<b>2</b> (<figref idrefs=\"DRAWINGS\">FIG. 1</figref>) continues, the entire context information is preserved. At this stage the CMS of the Transmeta processor is retained private memory <b>5</b>.</p><p num=\"p-0045\">While shutting down (i.e. before removing the power), CMS detects the Instant STR event and sets a corresponding flag (e.g. the \u201cSTR signature\u201d) in non-volatile memory. This enables the code morphing software to detect the Instant STR condition upon a power-on-reset, as later herein described. The foregoing flag may be implemented by writing the STR signature into private memory <b>5</b>. Concurrently additional hardware, such as the Southbridge chip, serves to monitor the user input device <b>7</b> (<figref idrefs=\"DRAWINGS\">FIG. 1</figref>) represented at block <b>24</b>. If a negative determination is made, the checking continues as indicated at decisional block <b>26</b>. If, however, any user activity is detected, such as the user's manipulation of any user input device <b>7</b>, such as keyboard or mouse or the like, then an affirmative determination is made at decisional operation <b>26</b> and the computer initiates the operation, represented at block <b>28</b> to restore power to the CPU and execute the power up sequence. The latter operation returns the flow to operational block <b>11</b>, which was earlier described.</p><p num=\"p-0046\">The sequence of operation proceeds through the operations represented by operational blocks <b>13</b>, <b>15</b> and <b>19</b>, earlier described and not here repeated. When the boot loader checks for an STR signature this time as represented at block <b>19</b>, an affirmative determination is made at decisional block <b>21</b>. The processor clears the STR signature, 30, skips decompressing CMS as the software resides in the private memory, and, as represented in block <b>32</b> directly jumps into the CMS \u201cresume from STR\u201d routine vector in private memory <b>5</b>. The CMS commences by restoring the internal CPU context and Northbridge registers from the private memory into the appropriate registers of the CPU as represented at operation <b>34</b> and configures other memory <b>36</b>. With internal CPU context restored, all memories configured, and program state present in the private memory, the processor is restored to the state existing at the time of initiation of the sleep mode procedure at which juncture the processor may then retrieve the next instruction of the X86 target application for execution, as represented at block <b>38</b>. As one appreciates, the foregoing method completes rapidly.</p><p num=\"p-0047\">An alternative embodiment of the sleep mode invention would employ faster memory still, but would require modification to the structure of the Transmeta computer. Specifically, where it is practicable to modify the integrated circuit chip that contains the processor of the Transmeta computer so as to permit the on-chip caches to be powered up or down separately from the remaining elements of the processor, then it is possible to retain the internal context of the CPU within the processor during the sleep mode, avoiding the necessity for transferring the internal context to the private memory and back again during resume from the Instant STR procedure. Such a configuration is illustrated in <figref idrefs=\"DRAWINGS\">FIG. 3</figref>, in which the internal memory and cache <b>8</b> are powered by power domain P<b>4</b>, separate from the power domain P<b>1</b> of the other CPU elements. In as much as the memory employed for cache application is typically the fastest memory available, and the location is physically closer to the principal elements of the processor, propagation time is reduced. Further, the processing time to transfer the information is eliminated. In this embodiment, the memory serves both the function of cache and of the private memory found in the initial embodiment, earlier described.</p><p num=\"p-0048\">The foregoing invention may be incorporated within target processing systems that currently employ a sleep mode, such as the X86 system, but requires some modification to the target system's operating software. Since a memory of the X86 system is already powered separately from the CPU of the processing system and for sleep mode operation that memory is already used to store the state of the operating system and the application program, an extra portion of that external memory may be used to also store the internal context of the X86 CPU.</p><p num=\"p-0049\">Assume two levels of \u201csleep\u201d for the X86 type computer: A first level in which the central processing unit (CPU) of the processor maintains the CPU context and a second level, more deep than the first, in which the context of the CPU is not maintained. In the first level, the Southbridge circuit of the processor shuts off (sic \u201ckills\u201d) the input clocks to the CPU, but maintains power to the CPU. The BIOS and operating system (\u201cOS\u201d) of the computer typically uses the first level or state a good deal of the time, because the state is low-overhead. In the second level, the Southbridge circuit kills the CPU input clocks, as before, and then also removes electrical power to the CPU and other devices of the processor. As a result of the removal of electrical power, the context information of the CPU state is lost. The BIOS and OS of the computer uses this second state less frequently than the first because the state is high overhead.</p><p num=\"p-0050\">The present invention permits transparent power cycling of the CPU, turning the CPU off and then turning the CPU on, repeatedly at will, with low overhead (e.g. virtually maintaining the CPU context). Two embodiments of the invention are thus possible. The invention may replace the STR process found in the X86 processor system. In such an embodiment, the resume process restores the processor more quickly than the existing STR procedure although no savings is made in power consumption.</p><p num=\"p-0051\">In a preferred embodiment, the invention replaces the CPU context-maintaining sleep state of the X86 system (e.g. \u201cdeep sleep\u201d which is the deepest CPU context maintaining sleep mode) and the invention \u201ctricks\u201d the BIOS and/or OS to \u201cthink\u201d that the CPU is placed in the sleep mode, deep sleep, when, in fact, once the BIOS and OS initiates the \u201cdeep sleep\u201d action, all electrical power is removed from the CPU and the CPU enters the Instant STR condition. The advantage is that less power is consumed over time than when the CPU is placed in sleep mode. And with the benefit of the very rapid resume from STR action available with the invention the computer user never knows that the CPU had been turned off.</p><p num=\"p-0052\">The foregoing second embodiment is possible of accomplishment in two different species. In the first specie of the preferred embodiment the code morphing software of the Transmeta processor intercepts the command issued by the operating system, such as Windows 9X, to shut down the CPU clock input to the CPU. Then the code morphing software issues a command to power down the CPU completely, that is, disable the CPU clock input and also remove electrical power from the CPU. Thus while the operating system \u201cthinks\u201d that the CPU remains powered, in fact, the CPU is completely powered down. In that sense the action is transparent to the X86 OS software and to the BIOS. In existing computers the context of the CPU is lost in this power saving mode. In the present invention the CPU context is saved in private memory <b>5</b>.</p><p num=\"p-0053\">The second species of the preferred embodiment requires the BIOS and/or the OS software to be modified to explicitly invoke an Instant STR operation. It may not be possible to accomplish this in computers that use a \u201cclosed\u201d operating system, such as WINDOWS 9X, that can only be modified by the copyright owner, but can be readily accomplished in \u201copen\u201d operating systems, such as the familiar LINUX operating system. In new generations of BIOS and OS software, such a command may be easily incorporated, if timely suggested to the designers of such software.</p><p num=\"p-0054\">By powering down the CPU additional power savings may be achieved when the computer is left idle. In the case of present CPU's operating at 600 MHz, the power saving is about sixty milliwatts. That savings would increase for computers in the future that contain future versions of CPU's containing process technology advances that typically allow higher operating frequencies, but result in greater power consumption in sleep mode.</p><p num=\"p-0055\">It is believed that the foregoing description of the preferred embodiments of the invention is sufficient in detail to enable one skilled in the art to make and use the invention. However, it is expressly understood that the detail of the elements presented for the foregoing purpose is not intended to limit the scope of the invention, in as much as equivalents to those elements and other modifications thereof, all of which come within the scope of the invention, will become apparent to those skilled in the art upon reading this specification. Thus, the invention is to be broadly construed within the full scope of the appended claims.</p><?DETDESC description=\"Detailed Description\" end=\"tail\"?></description>"}], "inventors": [{"first_name": "Marc", "last_name": "Fleischmann", "name": ""}, {"first_name": "H. Peter", "last_name": "Anvin", "name": ""}], "assignees": [{"first_name": "", "last_name": "", "name": "TRANSMETA CORPORATION"}, {"first_name": "", "last_name": "COMPLEX MEMORY LLC", "name": ""}, {"first_name": "", "last_name": "INTELLECTUAL VENTURES ASSETS 40 LLC", "name": ""}, {"first_name": "", "last_name": "INTELLECTUAL VENTURES HOLDING 81 LLC", "name": ""}, {"first_name": "", "last_name": "INTELLECTUAL VENTURES HOLDING 81 LLC", "name": ""}, {"first_name": "", "last_name": "INTELLECTUAL VENTURE FUNDING LLC", "name": ""}, {"first_name": "", "last_name": "TRANSMETA LLC", "name": ""}, {"first_name": "", "last_name": "TRANSMETA CORPORATION", "name": ""}, {"first_name": "", "last_name": "TRAMSMETA CORPORATION A CALIFORNIA CORPORATION", "name": ""}], "ipc_classes": [{"primary": true, "label": "G06F   1/32"}], "locarno_classes": [], "ipcr_classes": [{"label": "G06F   1/32        20060101A I20060722RMUS"}, {"label": "G06F  11/14        20060101A I20080531RMEP"}], "national_classes": [{"primary": true, "label": "713324"}, {"primary": false, "label": "365228"}, {"primary": false, "label": "713300"}, {"primary": false, "label": "714E1114"}, {"primary": false, "label": "712228"}, {"primary": false, "label": "365229"}], "ecla_classes": [{"label": "G06F   1/32P1D"}, {"label": "G06F   9/44A6"}, {"label": "G06F   1/32P5N"}, {"label": "Y02B60:18H"}], "cpc_classes": [{"label": "G06F   1/3228"}, {"label": "G06F   1/3246"}, {"label": "G06F   1/3246"}, {"label": "G06F   1/3228"}, {"label": "Y02D  30/50"}, {"label": "G06F   9/4418"}, {"label": "Y02D  30/50"}, {"label": "G06F   1/3234"}, {"label": "Y02D  10/00"}, {"label": "G06F   9/4418"}, {"label": "Y02D  10/00"}], "f_term_classes": [], "legal_status": "Expired - Lifetime", "priority_date": "2000-06-16", "application_date": "2000-06-16", "family_members": [{"ucid": "US-7730330-B1", "titles": [{"lang": "EN", "text": "System and method for saving and restoring a processor state without executing any instructions from a first instruction set"}]}, {"ucid": "US-8140872-B1", "titles": [{"lang": "EN", "text": "Restoring processor context in response to processor power-up"}]}, {"ucid": "US-6968469-B1", "titles": [{"lang": "EN", "text": "System and method for preserving internal processor context when the processor is powered down and restoring the internal processor context when processor is restored"}]}, {"ucid": "US-20120210155-A1", "titles": [{"lang": "EN", "text": "STORING CONTEXT INFORMATION PRIOR TO NOT SUPPLYING POWER TO A PROCESSOR"}]}, {"ucid": "US-20130311802-A1", "titles": [{"lang": "EN", "text": "MAINTAINING PROCESSOR CONTEXT BEFORE ENTERING POWER SAVING MODE"}]}]}