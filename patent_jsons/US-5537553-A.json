{"patent_number": "US-5537553-A", "publication_id": 71273495, "family_id": 17920012, "publication_date": "1996-07-16", "titles": [{"lang": "EN", "text": "Method of and apparatus for bus control and data processor"}, {"lang": "EN", "text": "METHOD FOR CONTROLLING COMMUNICATION BETWEEN INTERNAL BUSES"}], "abstracts": [{"lang": "EN", "paragraph_markup": "<abstract lang=\"EN\" load-source=\"docdb\" mxw-id=\"PA10479830\" source=\"national office\"><p>In a processor having a central processing unit, an instruction cache and a data cache, a bus controller is provided for controlling giving and receiving of a signal between internal instruction and data buses and external bus. Upon concurrent miss of instruction cache and data cache, the bus controller executes an external instruction access with priority in case where the external instruction access is a same page access as a previous external DRAM access, and executes an external data access in the other cases. Thereby, the cycle number required for the external access is reduced, while reducing the number of instruction execution cycles as a total.</p></abstract>"}, {"lang": "EN", "paragraph_markup": "<abstract lang=\"EN\" load-source=\"patent-office\" mxw-id=\"PA37546683\"><p>In a processor having a central processing unit, an instruction cache and a data cache, a bus controller is provided for controlling giving and receiving of a signal between internal instruction and data buses and external bus. Upon concurrent miss of instruction cache and data cache, the bus controller executes an external instruction access with priority in case where the external instruction access is a same page access as a previous external DRAM access, and executes an external data access in the other cases. Thereby, the cycle number required for the external access is reduced, while reducing the number of instruction execution cycles as a total.</p></abstract>"}], "claims": [{"lang": "EN", "claims": [{"num": 1, "parent": -1, "type": "independent", "paragraph_markup": "<claim num=\"1\"><claim-text>1. A method for controlling communications between a plurality of internal buses of a data processor and a single external bus connected to an external memory device having a high speed access mode and a normal access mode, wherein<claim-text>the plurality of internal buses includes an internal instruction bus and an internal data bus,</claim-text><claim-text>the external memory device stores information, including instructions and data, identifiable by external access addresses, and</claim-text><claim-text>the data processor further comprises a CPU and an internal memory for storing a previous external access address of information previously accessed from the external memory device,</claim-text><claim-text>wherein the communication control method comprises the steps of:<claim-text>receiving communications from the CPU requesting information stored in the external memory device, comprising a plurality of external access requirements corresponding to the plurality of internal buses, including an external instruction access requirement corresponding to the internal instruction bus and an external data access requirement corresponding to the internal data bus;</claim-text><claim-text>comparing, with the previous external access address stored in the internal memory, an external access address of information requested by each of the plurality of external access requirements, including the external instruction access requirement and the external data access requirement,</claim-text><claim-text>judging, for each of the plurality of external access requirements, whether the external memory device is accessible at the high speed mode, based on the comparison results with the previous external access address;</claim-text><claim-text>selecting, from the plurality of external access requirements, an external access requirement to be processed with priority, based on the judged results of whether information requested by an external access requirement can be accessed from the external memory device at the high speed access mode, wherein if the external instruction access requirement and the external data access requirement are concurrently issued,<claim-text>the external instruction access requirement is selected if the judging results indicate that the external memory device is accessible at the high speed access mode for the external instruction access requirement but not for the external data access requirement,</claim-text><claim-text>but otherwise, the external data access requirement is selected access requirement is selected; and</claim-text></claim-text><claim-text>processing with priority the selected external access requirement by enabling the communication between the internal bus corresponding to the selected external access requirement and the external bus connected to external memory device.</claim-text></claim-text></claim-text></claim>"}, {"num": 2, "parent": 1, "type": "dependent", "paragraph_markup": "<claim num=\"2\"><claim-text>2. The bus controlling method according to claim 1, further comprising the steps of:<claim-text>pre-fetching information stored in the external memory device at an external access address calculated by incrementing the previous external access address by a predetermined value during a period when no external access requirements are issued;</claim-text><claim-text>judging whether the pre-fetched information corresponds to the information requested by each of the plurality of external access requirements; and</claim-text><claim-text>processing with priority an external access requirement which can use the pre-fetched information based on the judged result.</claim-text></claim-text></claim>"}, {"num": 3, "parent": -1, "type": "independent", "paragraph_markup": "<claim num=\"3\"><claim-text>3. A bus controller for controlling communications between a plurality of internal buses of a data processor and a single external bus connected to an external memory device having a high speed access mode and a normal access mode, wherein the plurality of internal buses includes an internal instruction bus and an internal data bus, and a communication comprises an external access requirement corresponding to an internal bus requesting information identified by an external access address and stored in the external memory device, wherein the bus controller comprises:<claim-text>first memory means for memorizing a previous external access address of information previously accessed from the external memory device;</claim-text><claim-text>comparison means for comparing an external access address of information requested by the plurality of external access requirements with the previous external access address memorized in the first memory means, including<claim-text>a first comparison means for comparing an external access address of information requested by the external instruction access requirement with the previous external access address, and</claim-text><claim-text>a second comparison means for comparing an external access address of information requested by the external data access requirement with the previous external access address;</claim-text></claim-text><claim-text>first judging means for judging, based on the first comparison results, whether the external memory device is accessible at the high speed access mode for each of the plurality of external access requirements; and</claim-text><claim-text>selection means for selecting an external access requirement to be processed with priority, based on the results of the first judging means;</claim-text><claim-text>first bus interface means for controlling communication between the plurality of internal buses and the external bus by enabling the communication of the selected external access requirement between the internal bus corresponding to the selected external access requirement and the external bus connected to the external memory device; and</claim-text><claim-text>first control means for controlling the selection means and the first bus interface means, wherein if the external instruction access requirement and the external data access requirement are concurrently issued,<claim-text>the external instruction access requirement is selected if the first judging means determines that the external memory device is accessible at the high speed access mode for the external instruction access requirement but not for the external data access requirement,</claim-text><claim-text>but otherwise, the external data access requirement is selected access requirement is selected.</claim-text></claim-text></claim-text></claim>"}, {"num": 4, "parent": 3, "type": "dependent", "paragraph_markup": "<claim num=\"4\"><claim-text>4. The bus controller according to claim 3, wherein the external memory device comprises a DRAM and the bus controller further comprises second memory means for memorizing bit width data indicating which bits of an external instruction access address and an external data access address correspond to an address of the DRAM employed as the external memory device, and wherein the first comparison means and said second comparison means use the bit width data stored in the second memory device to respectively modify comparisons of the external access addresses of the external instruction access requirement and the external data access requirement with the previous external access address stored in the first memory means.</claim-text></claim>"}, {"num": 5, "parent": 4, "type": "dependent", "paragraph_markup": "<claim num=\"5\"><claim-text>5. The bus controller according to claim 4, wherein said second memory means is a programmable memory device.</claim-text></claim>"}, {"num": 6, "parent": 3, "type": "dependent", "paragraph_markup": "<claim num=\"6\"><claim-text>6. The bus controller according to claim 3, further comprising,<claim-text>pre-fetch address generating means for generating, as a pre-fetch address, an external access address calculated by incrementing a previous external access address memorized in said first memory means by a predetermined value;</claim-text><claim-text>pre-fetch means for pre-fetching information from the external memory device stored at the pre-fetch address generated by said pre-fetch address generating means during a period when no external access requirements are issued;</claim-text><claim-text>third memory means for storing the information pre-fetched by said pre-fetch means;</claim-text><claim-text>second judging means for judging whether information stored in said third memory means corresponds to information requested by each of the plurality of external access requirements; and</claim-text><claim-text>second control means for controlling, based on each judging result of said second judging means, the communication between the plurality of internal buses and said third memory means, by enabling the communication of an external access requirement requesting information judged to correspond to information stored in said third memory means to be processed with priority.</claim-text></claim-text></claim>"}, {"num": 7, "parent": 6, "type": "dependent", "paragraph_markup": "<claim num=\"7\"><claim-text>7. The bus controller according to claim 6, further comprising:<claim-text>third comparison means for comparing an external access address corresponding to the external instruction access requirement with the pre-fetch address generated by said pre-fetch address generating means, to judge whether the information stored in said third memory means corresponds to the information requested by the external instruction access requirement, based on the comparison results; and</claim-text><claim-text>fourth comparison means for comparing an external access address corresponding to the external data access requirement with the pre-fetch address generated by said pre-fetch address generating means, to judge whether the information stored in said third memory means corresponds to the information requested by the external data access requirement, based on the comparison results.</claim-text></claim-text></claim>"}, {"num": 8, "parent": 7, "type": "dependent", "paragraph_markup": "<claim num=\"8\"><claim-text>8. The bus controller according to claim 7, further comprising:<claim-text>second bus interface means for controlling communication between said third memory means and the plurality of internal data buses; and</claim-text><claim-text>second control means for controlling the communication of the information stored in said third memory means to an internal bus, wherein, regardless of each judged result of the first judging means, the information is communicated to the internal instruction bus upon determination of conformity at said third comparison means, and the information is communicated to the internal data bus upon determination of conformity at said fourth comparison means.</claim-text></claim-text></claim>"}, {"num": 9, "parent": -1, "type": "independent", "paragraph_markup": "<claim num=\"9\"><claim-text>9. A data processor having a function of accessing, upon cache miss, an external memory device having a high speed access mode and a normal access mode via a single external bus, comprising:<claim-text>a central processing unit for respectively outputting an instruction access requirement having an instruction address and a data access requirement having a data address;</claim-text><claim-text>an internal instruction bus for transmitting an instruction;</claim-text><claim-text>an internal data bus for transmitting a data;</claim-text><claim-text>an instruction cache for storing an instruction to be executed at said central processing unit and for issuing an external instruction access requirement upon a miss to an instruction access requirement outputted from said central processing unit;</claim-text><claim-text>a data cache for storing a data to be used at said central processing unit and for issuing an external data access requirement upon a miss to a data access requirement outputted from said central processing unit; and</claim-text><claim-text>a bus controller for controlling communication of a signal between the external bus and one of said internal instruction bus and said internal data bus,</claim-text><claim-text>wherein said bus controller comprises:</claim-text><claim-text>first memory means for memorizing a previous external address indicating an address of an instruction or a data previously accessed from the external memory device;</claim-text><claim-text>first comparison means for comparing an instruction address regarding the external instruction access requirement with the previous external access address memorized in said first memory means, to judge whether the external memory device is accessible at the high speed access mode for an external instruction access requirement issued from said instruction cache;</claim-text><claim-text>second comparison means for comparing a data address regarding the external data access requirement with the previous external access address memorized in said first memory means, to judge whether the external memory device is accessible at the high speed access mode for an external data access requirement issued from said data cache;</claim-text><claim-text>selection means for selecting, as an external access address, one of an instruction address regarding the external instruction access requirement and a data address regarding the external data access requirement;</claim-text><claim-text>first bus interface means for governing communication of an instruction or a data between the external bus and one of the internal instruction bus and the internal data bus; and</claim-text><claim-text>first access control means for controlling said selection means and said first bus interface means respectively by processing the external instruction access requirement prior to the external data access requirement upon conformity at only said first comparison means out of the first and the second comparison means when the external instruction access requirement and the external data access requirement are concurrently issued, and processing the external data access requirement prior to the external instruction access requirement otherwise.</claim-text></claim-text></claim>"}, {"num": 10, "parent": 9, "type": "dependent", "paragraph_markup": "<claim num=\"10\"><claim-text>10. The data processor according to claim 9, wherein a DRAM is employed as the external memory device and said bus controller further comprises second memory means for memorizing a bit width data indicating which bits of instruction address and the data address correspond to an address of the DRAM wherein the first comparison means and said second comparison means use the bit width data stored in the second memory device to respectively modify comparisons of the instruction address of the external instruction access requirement and the data address of the external data access requirement with the previous external access address stored in the first memory means.</claim-text></claim>"}, {"num": 11, "parent": 10, "type": "dependent", "paragraph_markup": "<claim num=\"11\"><claim-text>11. The data processor according to claim 10, wherein said second memory means is a programmable memory device.</claim-text></claim>"}, {"num": 12, "parent": 9, "type": "dependent", "paragraph_markup": "<claim num=\"12\"><claim-text>12. The data processor according to claim 9, wherein said bus controller further comprises:<claim-text>pre-fetch address generating means for generating, as a pre-fetch address, an address calculated by incrementing a previous external access address memorized in said first memory means by a predetermined value;</claim-text><claim-text>pre-fetch means for pre-fetching an instruction or a data from said external memory device stored at the pre-fetch address generated by said pre-fetch address generating means during a period when none of the external instruction access requirement and the external data access requirements is issued;</claim-text><claim-text>third memory means for storing an instruction or a data pre-fetched by said pre-fetch means;</claim-text><claim-text>third comparison means for comparing an instruction address corresponding to the external instruction access requirement with the pre-fetch address generated by said pre-fetch address generating means, to judge whether the instruction or the data stored in said third memory means corresponds to the instruction requested by the external instruction access requirement issued from said instruction cache;</claim-text><claim-text>fourth comparison means for comparing a data address corresponding to the external data access requirement with the pre-fetch address generated by said pre-fetch address generating means, to judge whether the instruction or the data stored in said third memory means corresponds to the information requested by the external data access requirement issued form said data cache;</claim-text><claim-text>second bus interface means for controlling communication between said third memory means and one of the internal instruction bus and the internal data bus; and</claim-text><claim-text>second access control means for controlling said second bus interface means to communicate the instruction stored in said third memory means to said internal instruction bus regardless of the compared results of said first comparison means and said second comparison means upon determination of conformity at said third comparison means and to communicate the data stored in said third memory means to said internal data bus regardless of the compared results of said first comparison means and said second comparison means upon determination of conformity at said fourth comparison means.</claim-text></claim-text></claim>"}]}], "descriptions": [{"lang": "EN", "paragraph_markup": "<description lang=\"EN\" load-source=\"patent-office\" mxw-id=\"PDES317685237\"><?BRFSUM description=\"Brief Summary\" end=\"lead\"?><h4>BACKGROUND OF THE INVENTION</h4><p>This invention relates to a high performance data processor capable of efficiently using a high speed access mode of an external memory device.</p><p>A dynamic random access memory (DRAM) is frequently used as an external memory device of a data processor. Some kinds of DRAM have a high speed access mode and a normal access mode. A page mode is well known as one of the high speed access mode. According to the page mode, sequential provision of pulses of a column address strobe signal (/CAS) while maintaining a row address strobe signal (/RAS) to low level makes high speed read/write operation possible, compared with the normal access mode which activates both/RAS and/CAS at every time. In other words, in case where the DRAM is accessed again with the same row address as that of a previous access, e.g. in case of page hit, high speed access is possible, compared with a case of page miss.</p><p>In general, in an external memory device, an instruction address space and a data address space are separated from each other. In the DRAM having the high speed access mode and the normal access mode, a data access subsequent to an instruction access and an instruction access subsequent to a data access are executed at normal speed with page miss. On the other hand, an instruction access subsequent to another instruction access and a data access subsequent to another data access are usually executed at high speed with page hit.</p><p>Some conventional processors have a central processing unit (CPU), an instruction cache and a data cache. In the processor of a pipeline operation with such an architecture, there is a case where the instruction cache and the data cache miss at a same CPU cycle, so that the instruction cache issues an external instruction access requirement and the data cache issues an external data access requirement. Conventionally, when the external instruction access requirement and the external data access requirement are issued concurrently, the external data access requirement is processed with priority without exception. Therefore, the high speed access mode of the external memory device cannot be used efficiently. A concrete example thereof is explained with reference to FIG. 5.</p><p>FIG. 5 is a time chart showing an example of a pipeline operation of a conventional processor having a CPU, an instruction cache and a data cache. Suppose that: the processor of this example is a RISC processor which executes one instruction in one CPU cycle basically; and the pipeline has four stages of instruction fetch stage, load stage, execution stage and store stage. According to the pipeline operation, when a preceding instruction proceeds to a further stage, instructions other than an instructions which cannot proceed in the pipeline owing to a cache miss or the like out of the subsequent instructions proceed to a further stage. Also, suppose that it takes three cycles in case of DRAM access of normal mode (page miss) and one cycle in case of DRAM access of high speed mode (page hit) to supply an instruction or a data to the CPU from the time at cache miss.</p><p>The pipeline operation and the external memory access operation are explained, referring to FIG. 5.</p><p>An instruction A, an instruction B, an instruction C, an instruction D and an instruction E are respectively executed in this order in the pipeline operation. The instruction A and the instruction B are instructions for reading a data into the CPU. At cycle 1 and cycle 2, respective instruction fetches for the instruction A and the instruction B are executed with instruction cache hit. A data cache access for the instruction A and an instruction cache access for the instruction C are executed at a same cycle of cycle</p><p>When both the instruction cache and the data cache miss, an external instruction access requirement and an external data access requirement are respectively issued from the instruction cache and the data cache concurrently at the cycle 3. In this case, the access requirement for the preceding instruction, i.e. the external data access requirement of the instruction A is processed first, then the external instruction access requirement of the instruction C is processed.</p><p>Accordingly, the external data access that the instruction A requires starts at cycle 4. Suppose that a previous external access is an instruction access, the external access is executed at normal mode with page miss and is completed in three cycles of cycles 4, 5 and 6. At cycle 7, a data is supplied to the CPU, and the instruction A proceeds to the store stage and the subsequent instruction B proceeds to the execution stage. The instruction C stays on the instruction fetch stage since the instruction fetch therefor is not complete.</p><p>The external instruction access for the instruction C starts after the external data access for the instruction A is completed, namely starts at the cycle 7. In this case, the external instruction access for the instruction C is executed at the normal mode with page miss since the previous external access is the data access for the instruction A. Accordingly, the external instruction access for the instruction C is executed at cycles 7, 8, 9. The instruction C is supplied to the CPU at cycle 10, so that the instruction C proceeds to the load stage and the subsequent instruction D proceeds to the instruction fetch stage at cycle 10.</p><p>When the access to data cache for the preceding instruction B at cycle 7 misses, the external data access for the instruction B starts at the cycle 10 after the fetch for the instruction C from the external memory is completed. Since the previous external access is the fetch for the instruction, the external memory access is executed at the normal mode with page miss at cycles 10, 11, 12. The data is supplied to the CPU at cycle 13. The instruction B proceeds to the store stage and the subsequent instruction C proceeds to the execution stage at cycle 13. Wherein, since the instruction fetch for the instruction D is not completed owing to a cache miss of the instruction D at cycle 10, the instruction stays on the instruction fetch stage.</p><p>After the data fetch for the instruction B is completed, the external instruction access for the instruction D starts at cycle 13. In this case, since the previous external access is the data fetch, the external memory access is executed at the normal mode at cycles 13, 14, 15, so that the instruction D is supplied to the CPU at cycle 16. At the cycle 16 the instruction D proceeds to the load stage and the subsequent instruction E proceeds to the instruction fetch stage.</p><p>According to this example, the instruction D can proceed to the load stage at cycle 5 upon always hit of both the instruction cache and the data cache. Actually, however, as described above, the instruction D shall proceed thereto at cycle 16 owing to the miss, which is eleven-cycle delay.</p><h4>SUMMARY OF THE INVENTION</h4><p>The present invention has its object of providing a high performance processor with reduced cycle number of external access by efficiently using the high speed access mode of the external memory device.</p><p>To attain the above object, in the present invention, out of the plural concurrently-issued external access requirements, an external access requirement which can access the external memory device at the high speed access mode is processed with priority. The possibility of access at the high speed access mode depends on a previous external access address. In detail, the external instruction access requirement is processed with priority when the external instruction access is the same page access as a previous DRAM access upon concurrent misses of instruction cache and data cache.</p><p>Further, during a period when no external access requirements is issued, an instruction or a data is pre-fetched from the external memory device with an address that a previous external access address is updated by a set value. An external access requirement which can use a pre-fetched instruction or data is processed with priority, if any.</p><p>According to the present invention, the efficient use of the high speed access mode of the external memory device reduces the number of cycles required for the external access, while improving the performance of the processor. Also, the efficient use of the period when no external access requirements is issued further reduces the number of cycles required for the external access, improving the performance of the processor.</p><?BRFSUM description=\"Brief Summary\" end=\"tail\"?><?brief-description-of-drawings description=\"Brief Description of Drawings\" end=\"lead\"?><h4>BRIEF DESCRIPTION OF THE DRAWINGS</h4><p>FIG. 1 is a block diagram showing an inside construction of a processor and an external connection thereto according to a first embodiment of the present invention.</p><p>FIG. 2 is a time chart showing an example of a pipeline operation of the processor in FIG. 1.</p><p>FIG. 3 is a block diagram showing an inside construction of a processor and an external connection thereto according to a second embodiment of the present invention.</p><p>FIG. 4 is a time chart showing an example of a pipeline operation of the processor in FIG. 3.</p><p>FIG. 5 is a time chart showing an example of a pipeline operation of a conventional processor.</p><?brief-description-of-drawings description=\"Brief Description of Drawings\" end=\"tail\"?><?DETDESC description=\"Detailed Description\" end=\"lead\"?><h4>DETAILED DESCRIPTION OF PREFERRED EMBODIMENTS</h4><p>Description is made below about a data processor according to embodiments of the present invention, with reference to accompanying drawings.</p><h4>FIRST EMBODIMENT</h4><p>FIG. 1 is a block diagram showing an inside construction of a processor and an external connection thereto according to the first embodiment of the present invention. In FIG. 1, a processor 1 is a RISC processor provided with a central processing unit (CPU) 2, an instruction cache 8, a data cache 4 and a bus controller 5, and executes one instruction in one CPU cycle basically. The pipeline has four stages of an instruction fetch stage, load stage, execution stage and store stage.</p><p>A DRAM 14 employed as an external memory device of the processor 1 is connected to the processor 1 via an address bus 32 and an instruction/data bus 42. A memory controller 13 is intervened between the address bus 32 and the DRAM 14, and supplies a multiplex address 33 and an access control signal 34 to the DRAM 14. The multiplex address 33 is an address AD on the address bus 32 which is multiplexed to a row address (upper part of AD) and a column address (lower part of AD) for access to the DRAM 14. The access control signal 34 includes a row address strobe signal (/RAS), a column address strobe signal (/CAS) and the like. The memory controller 13 generates an access control signal 34 so as to correspond to respective kinds of DRAM access mode, such as normal access mode, high speed access mode, refresh mode. As the high speed access mode, there are page mode, static column mode and the like. In case where a row address is the same as a previous access, a high speed DRAM access is possible at any high speed access modes.</p><p>The processor 1 is further provided with an internal instruction bus 40 and an internal data bus 41. The CPU 2 outputs an instruction access requirement 22 together with an instruction address 20 and a data access requirement 23 together with a data address 21 respectively. The instruction cache 3 is means for storing an instruction to be executed in the CPU 2 and issues an external instruction access requirement 27 upon a miss to the instruction access requirement 22. The data cache 4 is means for storing a data to be used in the CPU 2 and issues an external data access requirement 28 upon a miss to the data access requirement 23.</p><p>The bus controller 5 is means for controlling giving and 20 receiving of a signal between the instruction/data bus 42 and one of the internal instruction bus 40 and the internal data bus 41, and is provided with first and second comparators 6, 7, a control circuit 8, a selector 9, an output tri-state buffer 10, an address latch 11, a DRAM bit width store register 12 and a bus interface 15.</p><p>The selector 9 selects one of the instruction address 20 and the data address 21 according to an address selection signal 29 outputted from the control circuit 8. Reference numeral 30 denotes an external access address selected by the selector 9. The output tri-state buffer 10 buffers and outputs the selected external access address 30 to the address bus 32. The address latch 11 memorizes a previous external access address. Reference numeral 31 denotes a previous external access address outputted from the address latch 11.</p><p>The first comparator 6 compares the instruction address 20 with the previous external access address 31 outputted from the address latch 11. The second comparator 7 compares the data address 21 with the previous external access address 31 outputted from the address latch 11. Wherein, respective comparison ranges in both comparators 6, 7 are restricted by a bit width data 24 indicating to which part of the instruction address 20 and the data address 21 a row address of the DRAM 14 corresponds. The bit width data 24 is outputted from the DRAM bit width store register 12. The CPU 2 sets the bit width data 24 into the DRAM bit width store register 12 via a write bus 35 by executing a write instruction. Reference numeral 25 denotes a compared result of the first comparator 6 and 26 denotes a compared result of the second comparator 7.</p><p>The control circuit 8 decides whether the external instruction access is to be executed or the external data access is to be executed according to the compared results 25, 26 of first and second comparator 6, 7, the external instruction access requirement 27 and the external data access requirement 28 to supply the address selection signal 29 to the selector 9 and the bus interface 15. The bus interface 15 governs giving and receiving of instruction and data between the instruction/data bus 42 and one of the internal instruction bus 40 and the internal data bus 41 according to the address selection signal 29.</p><p>Pipeline operation of the processor 1 with the above construction is discussed first.</p><p>On the instruction fetch stage of first stage, the CPU 2 outputs the instruction address 20 and the instruction access requirement 22 to execute the access to instruction cache 3. Upon hit of instruction cache 3, an instruction is read out from the instruction cache 3 onto the internal instruction bus 40 to supply to the CPU 2. Then, the pipeline operation proceeds to the load stage.</p><p>Upon miss of instruction cache 3, however, the external instruction access requirement 27 is sent from the instruction cache 3 to the bus controller 5. According to the external instruction access requirement 27, the control circuit 8 in the bus controller 5 controls the selector 9 so as to execute an external instruction access to the DRAM 14. In detail, the instruction address 20 is selected by the selector 9 according to the address selection signal 29 outputted from the control circuit 8 and the external access address 30 is outputted to the address bus 32 via the output tri-state buffer 10, thereby the external access starts. In case of external access unachievable such as that a previous external access is not completed, that a device other than the processor 1 uses the external bus (address bus 32 and instruction/data bus 42), the processor 1 starts the external access after the external bus is released.</p><p>When the external access starts, the memory controller 3 generates the multiplex address 33 and the access control signal 34 to execute an access to the DRAM 14. The instruction read out onto the instruction/data bus 42 from the DRAM 14 is outputted onto the internal instruction bus 40 by the bus interface 15 to be forwarded to the CPU 2. The instruction fetched from the DRAM 14 in this way is written into the instruction cache 3 at the same time as it is forwarded to the CPU 2 so as to execute following instruction accesses at high speed.</p><p>After the instruction fetch is completed, the CPU 2 proceeds to the load stage of second stage. The instruction is decoded on the load stage.</p><p>On the execution stage of third stage, the instruction is executed. For example, if the instruction is an instruction for reading a data, the data address 21 and the data access requirement 23 are outputted from the CPU 2 to execute an access to the data cache 4. Upon hit of the data cache 4, the data is read out from the data cache 4 onto the internal data bus 41 and supplied to the CPU 2. Then, the pipeline operation proceeds to the store stage.</p><p>Upon miss of the data cache 4, however, the data cache 4 sends the external data access requirement 28 to the bus controller 5. According to the external data access requirement 28, the control circuit 8 in the bus controller 5 controls the selector 9 so as to execute the external data access to the DRAM 14. In detail, the selector 9 selects the data address 21 according to the address selection signal 29 outputted from the control circuit 8, so that the external access starts as well as the case of instruction cache miss, and the data is read out from the DRAM 14 onto the instruction/data bus 42 via the memory controller 13. The data read out to the instruction/data bus 42 is outputted to the internal data bus 41 by the bus interface 15 and is forwarded to the CPU 2. The data fetched from the DRAM 14 in this way is written into the data cache 4 at the same time as it is forwarded to the CPU 2 so as to execute following data accesses at high speed.</p><p>After the data fetch is completed, the CPU 2 proceeds to the store stage of fourth stage. On the store stage, the data read out from the data cache 4 or the DRAM 14 is stored into a register in the CPU 2, thus terminating the one instruction.</p><p>As described above, an instruction access requirement 22 is asserted at a cycle for executing an instruction fetch in the CPU 2 and a data access requirement 23 is asserted at a cycle for executing a data access. Then, the instruction cache 3 reads out an instruction corresponding to the instruction address 20 and the data cache 4 reads out a data corresponding to the data address 21. At this time, the instruction is supplied from the instruction cache 3 to the CPU 2 via the internal instruction bus 40 upon hit of the instruction cache 3, and the data is supplied from the data cache 4 to the CPU 2 via the internal data bus 41 upon hit of the data cache 4. The external instruction access requirement 27 upon miss of the instruction cache 3 and the external data access requirement 28 upon miss of the data cache 4 are respectively forwarded to the bus controller 5 to execute access to the DRAM 14.</p><p>Since the processor 1 is in the pipeline operation, the external instruction access requirement 27 and the external data access requirement 28 may be issued at a same CPU cycle. The operation in this case is discussed next.</p><p>When the external instruction access requirement 27 and the external data access requirement 28 are issued at the same time, the first comparator 6 compares the previous external access address 31 with the instruction address 20 and the second comparator 7 compares the previous external access address 31 with the data address 21 in the bus controller 5. Each comparison is executed only for a bit of a set region according to the respective bit-width data 24 so as to judge whether the DRAM 14 can be accessed at the high speed mode. Then in the control circuit 8, an external access which is accessible at the high speed mode is processed with priority based on the compared results 25, 26 of first and second comparators 6, 7. The priority order is indicated in Table 1. The compared results 25, 26 respectively becomes \"1\" upon conformity.</p><p></p><pre listing-type=\"tabular\" xml:space=\"preserve\"><!--Greenbook tabular data-->              TABLE 1                                                     \n______________________________________                                    \ncompared       compared     order of                                      \nresult 25 of   result 26 of external                                      \ncomparator 6   comparator 7 access                                        \n______________________________________                                    \nCASE 1  0          0            (1)data (2)inst.                          \nCASE 2  0          1            (1)data (2)inst.                          \nCASE 3  1          0            (1)inst. (2)data                          \nCASE 4  1          1            (1)data (2)inst.                          \n______________________________________                                    \n</pre><p>As indicated in Table 1, when the conformity is obtained at only the first comparator 6 out of first and second comparators 6, 7, the external instruction access is executed prior to the external data access. In the other cases, the external data access for a preceding instruction is executed with priority as the instruction order. Accordingly, the high speed access mode of the DRAM 14 can be efficiently used, which is described with reference to FIG. 2.</p><p>FIG. 2 is a time chart showing an example of pipeline operation of the processor 1 in FIG. 1. As well as in the conventional example, suppose that: when a preceding instruction proceeds to a further stage, instructions other than an instruction which cannot proceed in the pipeline owing to a cache miss or the like out of the subsequent instructions proceed to a further stage; and it takes three cycles in case of DRAM access at the normal mode (page miss) and one cycle in case of DRAM access at the high speed mode (page hit) to supply the instruction or the data to the CPU 2 from the time at cache miss.</p><p>Referring to FIG. 2, the pipeline operation and the external memory access operation of the processor 1 in FIG. 1 are described below.</p><p>An instruction A, an instruction B, an instruction C, an instruction D and an instruction E are respectively executed in this order in the pipeline operation. Suppose that the instruction A and the instruction B are instructions for reading a data into the CPU 2. At cycles 1 and 2, the instruction fetches for the instruction A and the instruction B are respectively executed with instruction cache hit. An access to the data cache 4 for the instruction A and an access to the instruction cache 3 for the instruction C are executed at the same cycle 3.</p><p>Then, in case of both misses of instruction cache 3 and the data cache 4, the external instruction access requirement 27 and the external data access requirement 28 are issued to the bus controller 5 at the cycle 3. If a previous external access is an instruction access, only the instruction address 20 out of the instruction address 20 and the data address 21 conforms at a row address part to the previous external access address 31 (page hit). Thus, the external instruction access for the instruction C is executed prior to the data access for the instruction A (CASE 3 in Table 1). At this time, since the DRAM 14 is accessible at the high speed mode, the external memory access is completed in one cycle of cycle 4, thus obtaining the instruction C to be fetched. At cycle 5, the instruction C is supplied to the CPU 2 and written into the instruction cache 3. However, since the data access for the preceding instruction A is not completed, the pipeline operation cannot proceed.</p><p>Continuously, the external data access for the instruction A is executed. While, since the previous access is the external instruction access and does not conform thereto at the row address part, the external data access for the instruction A is executed at the normal mode, which takes three cycles of cycles 5, 6, 7. Then, at cycle 8, the data is supplied to the CPU 2 and is written into the data cache 4. Since the fetch for the instruction C is already completed, all of the instructions proceed to the next stage.</p><p>At the cycle 8, suppose that: the access to the data cache 4 for the instruction B and the access to the instruction cache 3 for the instruction D are executed; and both caches 3, 4 miss again. In this time, since the previous access is the external data access for the instruction A, only the data address 21 out of the instruction address 20 and the data address 21 conforms at the row address part to the previous external access address 31 (page hit). Thus, the external data access for the instruction B is executed with priority (CASE 2 in Table 1). At this time, since the DRAM 14 is accessible at the high speed mode, the external memory access is completed in one cycle of cycle 9, thus obtaining a data to be fetched. At cycle 10, the data is supplied to the CPU 2 and is written into the data cache 4, so that the instruction B and the instruction C proceed to the next stage. Wherein, the fetch for the instruction D is not completed, staying on the instruction fetch stage.</p><p>Continuously, the external instruction access for the instruction D is executed. While, since the previous access is the external data access and does not conform thereto at the row address part, the external instruction access for the instruction D is executed at the normal mode, which takes three cycles of cycles 10, 11, 12 at the normal mode. Then, at cycle 13, the instruction D is supplied to the CPU 2 and is written into the instruction cache 3, so that the instruction D proceeds to the load stage and the subsequent instruction E proceeds to the instruction fetch stage.</p><p>As discussed above, according to this embodiment, the instruction D proceeds to the load stage at cycle 13, which is three-cycle less than the conventional one which requires 16 cycles. In other words, the same instruction group as in FIG. 5 is executed in high speed, enhancing the performance of the processor 1.</p><h4>SECOND EMBODIMENT</h4><p>FIG. 3 is a block diagram showing an inside construction of a processor and an external connection thereto according to the second embodiment of the present invention. In FIG. 3, as far as is possible the same reference numerals have been used as in FIG. 1 of the first embodiment, leaving out the explanation thereof.</p><p>In FIG. 3, the bus controller 5 is provided with a pre-fetch address generating circuit 100, third and fourth comparators 102, 103, a control circuit 106, a selector 109 and a buffer memory 111.</p><p>The pre-fetch address generating circuit 100 generates, as a pre-fetch address, an address that the previous external access address 31 outputted from the address latch 11 is incremented by a set value. Reference numeral 101 denotes a pre-fetch address generated by the pre-fetch address generating circuit 100. For example, in case of four-byte instruction/data width to be dealt with, the pre-fetch address generating circuit 100 generates the pre-fetch address 101 by adding 4 to the previous external access address 31.</p><p>Different from the selector 9 in FIG. 1, the selector 109 in this embodiment is a three-input selector and selects one of the instruction address 20, the data address 21 and the pre-fetch address 101 according to an address selection signal 107 outputted from the control circuit 106. Reference numeral 110 denotes an external access address selected by the selector 109. The buffer memory 111 is means for storing an instruction or a data pre-fetched from the DRAM 14, using the pre-fetch address 101, during the period when none of the external instruction access requirement 27 and the external data access requirement 28 is issued. Since the pre-fetch external access has the same row address as that of the previous external access in almost cases, the access to the DRAM 14 is executed at the high speed mode. Reference numeral 112 denotes an instruction or a data stored in the buffer memory 111.</p><p>Third and fourth comparators 102, 103 are means for judging whether the instruction or the data stored in the buffer memory 111 can be used. The third comparator 102 compares the instruction address 20 with the pre-fetch address 101. The fourth comparator 103 compares the data address 21 with the pre-fetch address 101. Reference numeral 104 is a compared result of the third comparator 102 and 105 is a compared result of the fourth comparator 103.</p><p>The control circuit 106 in this embodiment has a function of supplying the address selection signal 107 to the selector 109 so that the instruction or the data is stored into the buffer memory 111 during the period when none of the external instruction access requirement 27 and the external data access requirement 28 is issued. The control circuit 106 also has a function of supplying an instruction/data selection signal 108 to the bus interface 15 so as to transmit the instruction stored in the buffer memory 111 to the internal instruction bus 40 regardless of the compared results 25, 26 of first and second comparators 6, 7 upon conformity at the third comparator 102 and so as to transmit the data stored in the buffer memory 111 to the internal data bus 41 regardless of the compared results 25, 26 of first and second comparators 6, 7 upon conformity at the fourth comparator 103. Further, the control circuit 106 has a function of supplying the address selection signal 107 to the selector 109 and the instruction/data selection signal 108 to the bus interface 15 respectively, judging whether the external instruction access is to be executed or the external data access is to be executed according to the compared results 25, 26 of first and second comparators 6, 7, the external instruction access requirement 27 and the external data access requirement 28, as well as in the first embodiment.</p><p>According to the bus controller 5 in this embodiment with the above construction, the first comparator 6 compares the instruction address 20 with the previous external access address 31, the second comparator 7 compares the data address 21 with the previous external access address 31, the third comparator 102 compares the instruction address 20 with the pre-fetch address 101, and the fourth comparator 103 compares the data address 21 with the pre-fetch address 101.</p><p>Upon the conformity at the third comparator 102 when only the external instruction access requirement 27 is issued out of the external instruction access requirement 27 and the external data access requirement 28, the instruction 112 stored in the buffer memory ill-is outputted onto the internal instruction bus 40 and supplied to the CPU 2 since the instruction required by the CPU 2 is already pre-fetched and stored in the buffer memory 111. Upon no conformity at the third comparator 102 when only the external instruction access requirement 27 is issued out of the external instruction access requirement 27 and the external data access requirement 28, the external access to the DRAM 14 is executed using the instruction address 20.</p><p>Upon conformity at the fourth comparator 103 when only the external data access requirement 28 is issued out of the external instruction access requirement 27 and the external data access requirement 28, the data 112 stored in the buffer memory 111 is outputted onto the internal data bus 41 and supplied to the CPU 2 since the data required by the CPU 2 is already pre-fetched and stored in the buffer memory 111. Upon no conformity at the fourth comparator 103 when only the external data access requirement 28 is issued out of the external instruction access requirement 27 and the external data access requirement 28, the external access to the DRAM 14 is executed using the data address 21.</p><p>Upon conformity at the third comparator 102 when the external instruction access requirement 27 and the external data access requirement 28 are concurrently issued, the instruction 112 stored in the buffer memory 111 is supplied to the CPU 2 via the internal instruction bus 40 and the external data access is executed regardless of the compared results 25, 26 of first and second comparators 6, 7. Upon conformity at the fourth comparator 103 when the external instruction access requirement 27 and the external data access requirement 28 are concurrently issued, the data 112 stored in the buffer memory 111 is supplied to the CPU 2 via the internal data bus 41 and the external instruction access is executed regardless of the compared results 25, 26 of first and second comparators 6, 7. Also, upon no conformity at third and fourth comparators 102, 103 when the external instruction access requirement 27 and the external data access requirement 28 are concurrently issued, the external access is executed in the priority order based on the compared results 25, 26 of first and second comparator 6, 7 according to Table 1, as well as in the first embodiment.</p><p>With reference to FIG. 4, discussed is about that the high speed access mode of the DRAM 14 is further efficiently used by introducing the pre-fetch in this embodiment.</p><p>FIG. 4 is a time chart showing an example of the pipeline operation of the processor 1 in FIG. 3. As well as in the conventional example and the first embodiment, suppose that: instructions other than an instruction which cannot proceed in the pipeline owing to a cache miss or the like out of the subsequent instructions proceeds to a further stage when a preceding instruction proceeds to a further stage; and it takes three cycles in case of DRAM access at the normal mode (page miss) and one cycle in case of DRAM access at the high speed mode (page hit) to supply the instruction or the data to the CPU 2 from the time at cache miss.</p><p>The pipeline operation and the external memory access operation in the processor 1 in FIG. 3 are discussed, with reference to FIG. 4.</p><p>An instruction A, an instruction B, an instruction C, an instruction D and an instruction E are respectively executed in this order in the pipeline operation. Suppose that the instruction A and the instruction B are instructions for reading a data into the CPU 2. At cycles 1 and 2, the instruction fetches for the instruction A and the instruction B are respectively executed with the instruction cache hit. Further, the access to the data cache 4 for the instruction A and the access to the instruction cache 3 for the instruction C are executed at the same cycle 3.</p><p>Upon misses of the instruction cache 3 and the data cache 4, the external instruction access requirement 27 and the external data access requirement 28 are issued to the bus controller 5 at the cycle 3. If the instruction address 20 and the data address 21 do not conform to the pre-fetch address 101, only the instruction address 20 out of the instruction address 20 and the data address 21 conforms at the row address part to the previous external access address 31 when the previous external access is an instruction access, so that the external instruction access for the instruction C is executed prior to the data access for the preceding instruction A (CASE 3 in Table 1). At this time, since the DRAM 14 is accessible at the high speed mode, the external memory access is completed in one cycle of cycle 4, thus obtaining the instruction C to be fetched. At cycle 5, the instruction C is supplied to the CPU 2 and is written into the instruction cache 3. However, since the data access for the preceding instruction A is not completed, the pipeline operation cannot proceed to the next stage.</p><p>Continuously, the external data access for the instruction A is executed and completed in three cycles of cycles 5, 6, 7 at the normal mode since the previous access is the external instruction access and does not conform thereto at the row address part. Then, the data is supplied to the CPU 2 and is written into the data cache 4 at cycle 8.</p><p>Each instruction proceeds to the next stage at cycle 8. Since no external access requirement is present at the cycle 8, the data is pre-fetched with the next address subsequent to the address of the data A (address generated by the pre-fetch address generating circuit 100). The external access is completed in one cycle because the previous external access is a data access, so that the pre-fetch data is stored into the buffer memory 111 at cycle 9.</p><p>Also, the access to the data cache 4 for the instruction and the access to the instruction cache 3 for the instruction D are executed at the cycle 8. With misses of both caches 3.4, the external instruction access requirement 27 and the external data access requirement 28 are concurrently issued. At this time, the conformity of the data address 21 to the pre-fetch address 101 is detected by the fourth comparator 103, and the data 112 stored in the buffer memory 111 is supplied to the CPU 2 at the cycle 9. Then, the instruction B and the instruction C proceed to the next stage.</p><p>Further, since the requirement of the instruction fetch for the instruction D remains, the external instruction access for the instruction D starts at the cycle 9. This access is executed at the normal mode and is completed in three cycles of cycles 9, 10, 11 since the previous access is the external data access and does not conform thereto at the row address part. Then, at cycle 12, the instruction D is supplied to the CPU 2 and is written into the instruction cache 3 so that the instruction D proceeds to the load stage and the subsequent instruction E proceeds to the instruction fetch stage.</p><p>As described above, according to the second embodiment, the instruction D proceeds to the load stage at cycle 12 in contrast to the first embodiment at cycle 13 which means one-cycle reduction. In other words, the same instruction group as in FIG. 2 is executed in higher speed, enhancing the performance of the processor 1.</p><p>In first and second embodiments, the DRAM 14 is employed as the external memory device. But the same construction as in FIGS. 1 and 3 is possible in case where another memory device having a high speed access mode such as burst mode SRAM is employed. Also, the instruction cache 8 and the data cache 4 are built in the processor 1 in the embodiments, but the caches may be provided outside of the processor 1. In addition, the bit width data may be set directly to the DRAM bit width store register 12 via external pins of the processor 1.</p><?DETDESC description=\"Detailed Description\" end=\"tail\"?></description>"}], "inventors": [{"first_name": "Toru", "last_name": "Kakiage", "name": ""}], "assignees": [{"first_name": "", "last_name": "", "name": "MATSUSHITA ELECTRIC INDUSTRIAL CO., LTD."}, {"first_name": "", "last_name": "MATSUSHITA ELECTRIC INDUSTRIAL CO., LTD.", "name": ""}], "ipc_classes": [{"primary": true, "label": "H01J  13/00"}], "locarno_classes": [], "ipcr_classes": [{"label": "G06F  12/08        20060101A I20051008RMEP"}], "national_classes": [{"primary": true, "label": "710100"}, {"primary": false, "label": "711E12046"}, {"primary": false, "label": "711125"}], "ecla_classes": [{"label": "G06F  12/08B6M2"}], "cpc_classes": [{"label": "G06F  12/0848"}, {"label": "G06F  12/0848"}], "f_term_classes": [], "legal_status": "Expired - Fee Related", "priority_date": "1992-11-13", "application_date": "1993-11-10", "family_members": [{"ucid": "US-5537553-A", "titles": [{"lang": "EN", "text": "Method of and apparatus for bus control and data processor"}, {"lang": "EN", "text": "METHOD FOR CONTROLLING COMMUNICATION BETWEEN INTERNAL BUSES"}]}]}